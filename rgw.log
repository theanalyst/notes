[r@ra:~/ceph/src](⎇ master)$ s3 -us create my-first-bucket
Bucket successfully created.
[r@ra:~/ceph/src](⎇ master)$
Content-Length: 31
			 Bucket                                 Created
--------------------------------------------------------  --------------------
my-first-bucket                                           2014-09-17T05:17:43Z
[r@ra:~/ceph/src](⎇ master)$
./rados --pool .rgw ls
.bucket.meta.my-first-bucket:default.4124.1
my-first-bucket
./rados --pool .rgw.buckets.index ls
.dir.default.4124.1
[r@ra:~/ceph/src](⎇ master)$
s3 -us put my-first-bucket/file-1 filename=README
[r@ra:~/ceph/src](⎇ master)$ 
./rados --pool .rgw ls
.bucket.meta.my-first-bucket:default.4124.1
my-first-bucket
[r@ra:~/ceph/src](⎇ master)$ 
./rados --pool .rgw.buckets ls
default.4124.1_file-1

[r@ra:~/ceph/src](⎇ master)$ 
./radosgw-admin object stat --bucket=my-first-bucket --object=file-1
{ "name": "file-1",
  "size": 73,
  "policy": { "acl": { "acl_user_map": [
                { "user": "testid",
                  "acl": 15}],
          "acl_group_map": [],
          "grant_map": [
                { "id": "testid",
                  "grant": { "type": { "type": 0},
                      "id": "testid",
                      "email": "",
                      "permission": { "flags": 15},
                      "name": "M. Tester",
                      "group": 0}}]},
      "owner": { "id": "testid",
          "display_name": "M. Tester"}},
  "etag": "d7ca752aa7b83f15d7e59b79fc94dfa8",
  "tag": "default.4124.0",
  "manifest": { "objs": [],
      "obj_size": 73,
      "explicit_objs": "false",
      "head_obj": { "bucket": { "name": "my-first-bucket",
              "pool": ".rgw.buckets",
              "data_extra_pool": ".rgw.buckets.extra",
              "index_pool": ".rgw.buckets.index",
              "marker": "default.4124.1",
              "bucket_id": "default.4124.1"},
          "key": "file-1",
          "ns": "",
          "object": "file-1"},
      "head_size": 73,
      "max_head_size": 524288,
      "prefix": ".3eksdHasJNI38fsZkyMfnWaqm7xDs1S_",
      "tail_bucket": { "name": "my-first-bucket",
          "pool": ".rgw.buckets",
          "data_extra_pool": ".rgw.buckets.extra",
          "index_pool": ".rgw.buckets.index",
          "marker": "default.4124.1",
          "bucket_id": "default.4124.1"},
      "rules": [
            { "key": 0,
              "val": { "start_part_num": 0,
                  "start_ofs": 524288,
                  "part_size": 0,
                  "stripe_max_size": 4194304,
                  "override_prefix": ""}}]},
  "attrs": { "user.rgw.x-amz-date": "Wed, 17 Sep 2014 10:49:23 GMT"}}

# Create some random text & upload via S3 API
[r@ra:~]$ cat /dev/urandom | strings --bytes 1 | tr -d '\n\t ' | head --bytes 8192K > random.txt
[r@ra:~]$ ls -lh random.txt
-rw-rw-r-- 1 r r 8.0M Sep 17 18:08 random.txt
[r@ra:~/ceph/src](⎇ master)$ s3 -us put my-first-bucket/random filename=random.txt
8372224 bytes remaining (0% complete) ...
294912 bytes remaining (96% complete) ...
...

# Find the object manifest in order to get idea to reassemble the object
[r@ra:~/ceph/src](⎇ master)$ ./radosgw-admin object stat --bucket=my-first-bucket --object=random
{ "name": "random",
  "size": 8388608,
  "policy": { "acl": { "acl_user_map": [
                { "user": "testid",
                  "acl": 15}],
          "acl_group_map": [],
          "grant_map": [
                { "id": "testid",
                  "grant": { "type": { "type": 0},
                      "id": "testid",
                      "email": "",
                      "permission": { "flags": 15},
                      "name": "M. Tester",
                      "group": 0}}]},
      "owner": { "id": "testid",
          "display_name": "M. Tester"}},
  "etag": "fe0d04f8865fd6f95d079132746dc04b",
  "tag": "default.4124.0",
  "manifest": { "objs": [],
      "obj_size": 8388608,
      "explicit_objs": "false",
      "head_obj": { "bucket": { "name": "my-first-bucket",
              "pool": ".rgw.buckets",
              "data_extra_pool": ".rgw.buckets.extra",
              "index_pool": ".rgw.buckets.index",
              "marker": "default.4124.1",
              "bucket_id": "default.4124.1"},
          "key": "random",
          "ns": "",
          "object": "random"},
      "head_size": 524288,
      "max_head_size": 524288,
      "prefix": "._op2xmptte2DD7z3_9EjQKgmmRcWRWL_",
      "tail_bucket": { "name": "my-first-bucket",
          "pool": ".rgw.buckets",
          "data_extra_pool": ".rgw.buckets.extra",
          "index_pool": ".rgw.buckets.index",
          "marker": "default.4124.1",
          "bucket_id": "default.4124.1"},
      "rules": [
            { "key": 0,
              "val": { "start_part_num": 0,
                  "start_ofs": 524288,
                  "part_size": 0,
                  "stripe_max_size": 4194304,
                  "override_prefix": ""}}]},
  "attrs": { "user.rgw.x-amz-date": "Wed, 17 Sep 2014 12:40:42 GMT"}}
# Find the object names and get them
[r@ra:~/ceph/src](⎇ master)$ ./rados --pool .rgw.buckets ls | grep _op2xm
default.4124.1__shadow_._op2xmptte2DD7z3_9EjQKgmmRcWRWL_2
default.4124.1__shadow_._op2xmptte2DD7z3_9EjQKgmmRcWRWL_1
[r@ra:~/ceph/src](⎇ master)$ ./rados --pool .rgw.buckets ls | grep random
default.4124.1_random
[r@ra:~/ceph/src](⎇ master)$ ./rados get default.4124.1_random random.part0 --pool .rgw.buckets
[r@ra:~/ceph/src](⎇ master)$ ./rados get default.4124.1__shadow_._op2xmptte2DD7z3_9EjQKgmmRcWRWL_1 random.part1 --pool .rgw.buckets
[r@ra:~/ceph/src](⎇ master)$ ./rados get default.4124.1__shadow_._op2xmptte2DD7z3_9EjQKgmmRcWRWL_2 random.part2 --pool .rgw.buckets
# Now join the objects back 
[r@ra:~/ceph/src](⎇ master)$ cat random.part0 random.part1 random.part2 > random.rados.txt
[r@ra:~/ceph/src](⎇ master)$ diff random.txt random.rados.txt 
[r@ra:~/ceph/src](⎇ master)$
sha1sum random.txt
61ea6dd7ff4a2de1e9ed12a43d60c2bbfa59b038  random.txt
[r@ra:~/ceph/src](⎇ master)$
sha1sum random.
random.part0      random.part1      random.part2      random.rados.txt  random.txt
[r@ra:~/ceph/src](⎇ master)$
sha1sum random.rados.txt
61ea6dd7ff4a2de1e9ed12a43d60c2bbfa59b038  random.rados.txt
